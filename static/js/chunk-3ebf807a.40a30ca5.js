(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ebf807a"],{"52a8":function(t,e,r){"use strict";var n=r("9f37"),o=r.n(n);o.a},7426:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("IssueDetail",{attrs:{"is-show":!0}})],1)},o=[],a=r("9795"),s={components:{IssueDetail:a["a"]}},i=s,u=r("2877"),c=Object(u["a"])(i,n,o,!1,null,null,null);e["default"]=c.exports},9795:function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-row",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-text":"Xin vui lòng chờ","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("el-card",[r("el-row",{attrs:{slot:"header"},slot:"header"},[r("el-col",{staticStyle:{"margin-top":"10px"},attrs:{span:12}},[t._v("Thông tin phiếu xuất")]),t._v(" "),t.isShow?r("el-col",{attrs:{span:12}},[r("el-button",{staticClass:"fr",attrs:{disabled:t.form.confirmed,type:"primary",size:"small"},on:{click:function(e){return t.$router.push("/goods/issue/edit/"+t.form.id)}}},[t._v("Sửa phiếu xuất")])],1):r("el-col",{attrs:{span:12}},[t.isEdit?r("el-button",{staticClass:"fr",attrs:{type:"primary",size:"small"},on:{click:t.updateIssue}},[t._v("Sửa phiếu xuất")]):r("el-button",{staticClass:"fr",attrs:{type:"primary",size:"small"},on:{click:t.createIssue}},[t._v("Thêm phiếu xuất")])],1)],1),t._v(" "),r("el-row",{attrs:{gutter:30}},[r("el-form",{ref:"form",attrs:{disabled:t.isShow,model:t.form,rules:t.rules,"label-position":"left","label-width":"200px"}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"Mã phiếu xuất",prop:"code"}},[r("el-input",{model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"Người giao hàng"}},[r("el-input",{model:{value:t.form.delivery_man,callback:function(e){t.$set(t.form,"delivery_man",e)},expression:"form.delivery_man"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"Ngày giao hàng"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",clearable:!1,align:"center",format:"dd/MM/yyyy","value-format":"yyyy-MM-dd"},model:{value:t.form.delivery_date,callback:function(e){t.$set(t.form,"delivery_date",e)},expression:"form.delivery_date"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"Mô tả"}},[r("el-input",{attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"Ngày xuất phiếu"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",clearable:!1,align:"center",format:"dd/MM/yyyy","value-format":"yyyy-MM-dd"},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"Trạng thái"}},[r("el-switch",{attrs:{"active-text":"Đã xác nhận","inactive-text":"Chưa xác nhận"},model:{value:t.form.confirmed,callback:function(e){t.$set(t.form,"confirmed",e)},expression:"form.confirmed"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"Người nhận hàng"}},[r("el-input",{model:{value:t.form.recipient,callback:function(e){t.$set(t.form,"recipient",e)},expression:"form.recipient"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"SĐT người nhận hàng",prop:"phone_number"}},[r("el-input",{model:{value:t.form.phone_number,callback:function(e){t.$set(t.form,"phone_number","string"===typeof e?e.trim():e)},expression:"form.phone_number"}})],1)],1)],1)],1)],1),t._v(" "),r("el-card",{staticStyle:{"margin-top":"10px"}},[r("div",{attrs:{slot:"header"},slot:"header"},[t.isShow?r("span",[t._v("Thông tin sản phẩm")]):r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.showDialog=!0}}},[t._v("Thêm sản phẩm")])],1),t._v(" "),r("ProductList",{attrs:{"is-show":t.isShow,products:t.form.products,warehouses:t.warehouses}}),t._v(" "),r("SelectProductTable",{attrs:{"show-dialog":t.showDialog},on:{"select-product":function(e){return t.handleSelectProduct(e)},"update:showDialog":function(e){t.showDialog=e},"update:show-dialog":function(e){t.showDialog=e}}})],1)],1)},o=[],a=(r("ac6a"),r("7f7f"),r("96cf"),r("3b8d")),s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-row",[r("el-form",{attrs:{disabled:t.isShow,size:"mini"}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.products}},[r("el-table-column",{attrs:{align:"center",type:"index",width:"80",label:"STT"}}),t._v(" "),r("el-table-column",{attrs:{prop:"name",width:"250",label:"Tên"}}),t._v(" "),r("el-table-column",{attrs:{prop:"code",width:"250",label:"Mã"}}),t._v(" "),r("el-table-column",{attrs:{width:"200",label:"Kho hàng"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.warehouses.length>0?r("el-form-item",{staticClass:"mb-0"},[r("el-select",{attrs:{placeholder:"Kho hàng"},model:{value:t.products[e.$index].warehouse_id,callback:function(r){t.$set(t.products[e.$index],"warehouse_id",r)},expression:"products[scope.$index].warehouse_id"}},t._l(t.warehouses,(function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e()]}}])}),t._v(" "),r("el-table-column",{attrs:{width:"100",label:"Số lượng"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-form-item",{staticClass:"mb-0"},[r("el-input-number",{staticStyle:{width:"80px"},attrs:{"controls-position":"right",min:1},model:{value:t.products[e.$index].quantity,callback:function(r){t.$set(t.products[e.$index],"quantity",r)},expression:"products[scope.$index].quantity"}})],1)]}}])}),t._v(" "),r("el-table-column",{attrs:{width:"100",label:"Đơn vị"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-form-item",{staticClass:"mb-0"},[r("el-input",{model:{value:t.products[e.$index].unit,callback:function(r){t.$set(t.products[e.$index],"unit",r)},expression:"products[scope.$index].unit"}})],1)]}}])}),t._v(" "),r("el-table-column",{attrs:{width:"150",label:"Giá bán(đ)"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-form-item",{staticClass:"mb-0"},[r("el-input-number",{staticStyle:{width:"130px"},attrs:{"controls-position":"right",min:0},model:{value:t.products[e.$index].price,callback:function(r){t.$set(t.products[e.$index],"price",r)},expression:"products[scope.$index].price"}})],1)]}}])}),t._v(" "),r("el-table-column",{attrs:{width:"100",label:"Thuế"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-form-item",{staticClass:"mb-0"},[r("el-input-number",{staticStyle:{width:"80px"},attrs:{"controls-position":"right",min:0},model:{value:t.products[e.$index].tax,callback:function(r){t.$set(t.products[e.$index],"tax",r)},expression:"products[scope.$index].tax"}})],1)]}}])}),t._v(" "),r("el-table-column",{attrs:{width:"200",label:"Tiền thuế"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("money")((t.products[e.$index].quantity*t.products[e.$index].price*t.products[e.$index].tax/100).toFixed(2))))]}}])}),t._v(" "),r("el-table-column",{attrs:{width:"200",label:"Tiền hàng"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("money")((t.products[e.$index].quantity*t.products[e.$index].price).toFixed(2))))]}}])}),t._v(" "),t.isShow?t._e():r("el-table-column",{attrs:{fixed:"right",align:"center",label:"Xóa",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{circle:"",type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(r){return t.deleteProduct(e.$index)}}})]}}],null,!1,650268293)})],1)],1),t._v(" "),r("el-col",{attrs:{span:8,offset:16}},[r("p",[t._v("Tổng tiền hàng trước thuế: "+t._s(t._f("money")(t.total.toFixed(2)))+" đ")]),t._v(" "),r("p",[t._v("Tổng tiền hàng sau thuế: "+t._s(t._f("money")((t.total+t.tax).toFixed(2)))+" đ")])])],1)},i=[],u={props:["products","warehouses","isShow"],computed:{total:function(){return 0==this.products.length?0:this.products.map((function(t){return t.quantity*t.price})).reduce((function(t,e){return t+e}))},tax:function(){return 0==this.products.length?0:this.products.map((function(t){return t.quantity*t.price*t.tax/100})).reduce((function(t,e){return t+e}))}},data:function(){return{rules:[{}]}},methods:{deleteProduct:function(t){this.products.splice(t,1)}}},c=u,l=(r("52a8"),r("2877")),d=Object(l["a"])(c,s,i,!1,null,"1f2b5cc3",null),p=d.exports,h=r("61f7"),f=r("d1cd"),m=r("c67d"),b=r("9fbd"),v={components:{ProductList:p,SelectProductTable:f["a"]},props:["isEdit","isShow"],data:function(){var t=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();return{showDialog:!1,form:{id:"",code:"",description:"",delivery_man:"",delivery_date:t,date:t,recipient:"",phone_number:"",confirmed:!1,products:[]},loading:"",warehouses:[],rules:{code:[{required:!0,message:"Hãy xuất mã phiếu xuất",trigger:"blur"}],phone_number:[{required:!0,validator:h["c"],trigger:"blur"}]}}},methods:{createIssue:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs["form"].validate();case 3:if(this.validateIssueInfo()){t.next=5;break}return t.abrupt("return");case 5:return this.loading=!0,t.next=8,Object(m["d"])(this.form);case 8:e=t.sent,r=e.data,this.loading=!1,this.$router.push("/goods/issue/show/".concat(r.id)),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),t.t0.response&&(this.handleErrors(t.t0),this.loading=!1);case 17:case"end":return t.stop()}}),t,this,[[0,14]])})));function e(){return t.apply(this,arguments)}return e}(),handleErrors:function(t){var e=t.response.data.data;null===e.quantity?this.$message.error("Không tồn tại sản phẩm ".concat(e.product," trong kho ").concat(e.warehouse)):this.$message.error("Sản phẩm ".concat(e.product," trong kho ").concat(e.warehouse," chỉ còn ").concat(e.quantity," ").concat(e.unit))},getIssue:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.loading=!0,t.next=4,Object(m["c"])(this.$route.params.id);case 4:for(n in e=t.sent,r=e.data,this.isEdit&&r.confirmed&&this.$router.push("/404"),this.form)this.form[n]=r[n];this.loading=!1,t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](0),console.log(t.t0),this.loading=!1;case 15:case"end":return t.stop()}}),t,this,[[0,11]])})));function e(){return t.apply(this,arguments)}return e}(),updateIssue:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.loading=!0,t.next=4,this.$refs["form"].validate();case 4:if(this.validateIssueInfo()){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,Object(m["e"])(this.form,this.$route.params.id);case 8:t.sent,this.loading=!1,this.$router.push("/goods/issue/show/".concat(this.$route.params.id)),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),t.t0.response&&(this.handleErrors(t.t0),this.loading=!1);case 16:case"end":return t.stop()}}),t,this,[[0,13]])})));function e(){return t.apply(this,arguments)}return e}(),getWareHouses:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(b["b"])();case 3:e=t.sent,r=e.data,this.warehouses=r,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}(),handleSelectProduct:function(t){var e={name:t.name,code:t.code,product_id:t.id,warehouse_id:"",quantity:1,unit:t.unit,price:t.sale_price,tax:t.tax};this.form.products.push(e)},validateIssueInfo:function(){var t=this;if(0==this.form.products.length)return this.$message.error("Chưa có sản phẩm nào"),!1;var e=this.form.products.filter((function(t){return""==t.warehouse_id||void 0==t.quantity||void 0==t.tax||void 0==t.price}));if(e.length>0)return this.$message.error("Kho, số lượng, thuế và giá không được để trống!"),!1;var r=!1;return this.form.products.forEach((function(e){var n=t.form.products.filter((function(t){return t.product_id==e.product_id&&t.warehouse_id==e.warehouse_id}));n.length>1&&(r=!0)})),!r||(this.$message.error("Trùng sản phẩm và kho"),!1)}},created:function(){(this.isEdit||this.isShow)&&this.getIssue(),this.getWareHouses()}},g=v,x=Object(l["a"])(g,n,o,!1,null,null,null);e["a"]=x.exports},"9f37":function(t,e,r){},"9fbd":function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return s})),r.d(e,"a",(function(){return i}));var n=r("b775");function o(t){return Object(n["a"])({url:"/warehouses",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/warehouses",method:"post",data:t})}function s(t,e){return Object(n["a"])({url:"/warehouses/".concat(e),method:"put",data:t})}function i(t){return Object(n["a"])({url:"/warehouses/".concat(t),method:"delete"})}},bc50:function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return s})),r.d(e,"d",(function(){return i}));var n=r("b775");function o(t){return Object(n["a"])({url:"/products",method:"get",params:t})}function a(t,e){return Object(n["a"])({url:"/products/".concat(t),method:"get",params:e})}function s(t){return Object(n["a"])({url:"/products",method:"post",data:t})}function i(t,e){return Object(n["a"])({url:"/products/".concat(e),method:"put",data:t})}},c67d:function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return s})),r.d(e,"e",(function(){return i})),r.d(e,"a",(function(){return u}));var n=r("b775");function o(t){return Object(n["a"])({url:"/issues",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/issues/".concat(t),method:"get"})}function s(t){return Object(n["a"])({url:"/issues",method:"post",data:t})}function i(t,e){return Object(n["a"])({url:"/issues/".concat(e),method:"put",data:t})}function u(t){return Object(n["a"])({url:"/issues/".concat(t),method:"delete"})}}}]);